<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meme Coin Chaos</title>
<style>
body{
  font-family: Arial;
  background:#111;
  color:#fff;
  text-align:center;
}
.coin{
  margin:10px;
  padding:10px;
  border:1px solid #333;
}
button{
  margin:3px;
}
input{
  width:70px;
}
</style>
</head>
<body>

<h1>Meme Coin Chaos</h1>

<div id="news">Market stable...</div>
<div id="sentiment">Market Sentiment: Neutral</div>

<h3>Cash: $<span id="cash">1000</span></h3>
<h3>Net Worth: $<span id="networth">1000</span></h3>

<button onclick="tapIncome()">Tap for $<span id="tapValue">5</span></button>
<button onclick="upgradeTap()">Upgrade Tap ($<span id="upgradeCost">100</span>)</button>

<div id="coins"></div>

<script>

const TRANSACTION_FEE = 0.01;
const PRICE_CAP_MULTIPLIER = 50;

let cash = 1000;
let tapAmount = 5;
let tapLevel = 1;
let upgradeCost = 100;

let crashActive = false;
let lastCrashDelay = 0;
let marketGreedLevel = 0;
let lastWhaleCrashTime = 0;
const WHALE_COOLDOWN = 60*60*1000;

let coins = [
 {name:"DogeLordX", price:1, basePrice:1, volatility:0.03, trend:0, holdings:0, staked:0, totalSpent:0},
 {name:"QuantumPepe", price:2, basePrice:2, volatility:0.025, trend:0, holdings:0, staked:0, totalSpent:0},
 {name:"MoonRaccoon", price:0.5, basePrice:0.5, volatility:0.04, trend:0, holdings:0, staked:0, totalSpent:0},
 {name:"NebulaCat", price:3, basePrice:3, volatility:0.02, trend:0, holdings:0, staked:0, totalSpent:0},
 {name:"FrogChain", price:0.8, basePrice:0.8, volatility:0.035, trend:0, holdings:0, staked:0, totalSpent:0},
 {name:"PixelShiba", price:1.5, basePrice:1.5, volatility:0.03, trend:0, holdings:0, staked:0, totalSpent:0}
];

function saveGame(){
  localStorage.setItem("memeSave", JSON.stringify({
    cash,tapAmount,tapLevel,upgradeCost,coins
  }));
}

function loadGame(){
  let data = localStorage.getItem("memeSave");
  if(!data) return;
  let save = JSON.parse(data);
  cash = save.cash;
  tapAmount = save.tapAmount;
  tapLevel = save.tapLevel;
  upgradeCost = save.upgradeCost;
  coins = save.coins;
}

function tapIncome(){
  cash += tapAmount;
  updateUI();
}

function upgradeTap(){
  if(cash < upgradeCost) return;
  cash -= upgradeCost;
  tapLevel++;
  tapAmount = 5 * tapLevel;
  upgradeCost = Math.floor(upgradeCost * 1.8);
  updateUI();
}

function buy(i){
  let qty = parseFloat(document.getElementById(`qty-${i}`).value);
  if(isNaN(qty)||qty<=0) return;

  let totalCost = qty * coins[i].price * (1+TRANSACTION_FEE);

  if(totalCost > cash){
    qty = cash/(coins[i].price*(1+TRANSACTION_FEE));
  }

  if(qty<=0) return;

  let cost = qty*coins[i].price;
  let fee = cost*TRANSACTION_FEE;

  cash -= (cost+fee);
  coins[i].holdings += qty;
  coins[i].totalSpent += (cost+fee);

  updateUI();
}

function buyDollar(i){
  let dollars = parseFloat(document.getElementById(`dollar-${i}`).value);
  if(isNaN(dollars)||dollars<=0) return;

  if(dollars > cash) dollars = cash;

  let qty = dollars/(coins[i].price*(1+TRANSACTION_FEE));
  let cost = qty*coins[i].price;
  let fee = cost*TRANSACTION_FEE;

  cash -= (cost+fee);
  coins[i].holdings += qty;
  coins[i].totalSpent += (cost+fee);

  updateUI();
}

function sell(i){
  let qty = parseFloat(document.getElementById(`qty-${i}`).value);
  if(isNaN(qty)||qty<=0) return;

  if(qty > coins[i].holdings) qty = coins[i].holdings;
  if(qty<=0) return;

  let gross = qty*coins[i].price;
  let fee = gross*TRANSACTION_FEE;

  cash += (gross-fee);

  let totalCoins = coins[i].holdings+coins[i].staked;
  if(totalCoins>0){
    let ratio = qty/totalCoins;
    coins[i].totalSpent *= (1-ratio);
  }

  coins[i].holdings -= qty;

  updateUI();
}

function sellAll(i){
  let qty = coins[i].holdings;
  if(qty<=0) return;

  let gross = qty*coins[i].price;
  let fee = gross*TRANSACTION_FEE;

  cash += (gross-fee);

  let totalCoins = coins[i].holdings+coins[i].staked;
  if(totalCoins>0){
    let ratio = qty/totalCoins;
    coins[i].totalSpent *= (1-ratio);
  }

  coins[i].holdings = 0;

  updateUI();
}

function stake(i){
  let qty = parseFloat(document.getElementById(`qty-${i}`).value);
  if(isNaN(qty)||qty<=0) return;
  if(qty>coins[i].holdings) qty=coins[i].holdings;

  coins[i].holdings-=qty;
  coins[i].staked+=qty;
  updateUI();
}

function unstake(i){
  let qty = parseFloat(document.getElementById(`qty-${i}`).value);
  if(isNaN(qty)||qty<=0) return;
  if(qty>coins[i].staked) qty=coins[i].staked;

  coins[i].staked-=qty;
  coins[i].holdings+=qty;
  updateUI();
}

function updatePrices(){
  coins.forEach(c=>{
    c.trend += (Math.random()-0.5)*0.01;
    let change = (c.trend + (Math.random()-0.5)*c.volatility)*c.price;
    c.price += change;

    if(c.price < 0.01) c.price=0.01;
    if(c.price > c.basePrice*PRICE_CAP_MULTIPLIER)
      c.price = c.basePrice*PRICE_CAP_MULTIPLIER;
  });

  updateSentiment();
  updateUI();
}

function updateSentiment(){
  let avg = coins.reduce((a,c)=>a+c.trend,0)/coins.length;
  marketGreedLevel = avg*20;

  let text="Neutral";
  if(marketGreedLevel>0.6) text="Extreme Greed ðŸš€";
  else if(marketGreedLevel>0.2) text="Greed";
  else if(marketGreedLevel<-0.6) text="Extreme Fear";
  else if(marketGreedLevel<-0.2) text="Fear";

  document.getElementById("sentiment").innerText="Market Sentiment: "+text;
}

function triggerCrash(source){
  if(crashActive) return;
  crashActive=true;

  let strength=0.3+Math.random()*0.2;
  coins.forEach(c=>c.price*=1-strength);

  document.getElementById("news").innerText=
    source==="whale"?"Whale Crash!":"Market Crash!";

  setTimeout(()=>crashActive=false,10000);
}

function scheduleCrash(){
  let min=6*60*1000;
  let max=15*60*1000;
  let delay;
  do{
    delay=Math.floor(Math.random()*(max-min))+min;
  }while(delay===lastCrashDelay);
  lastCrashDelay=delay;

  setTimeout(()=>{
    let chance=0.25;
    if(marketGreedLevel>0.6) chance+=0.4;
    if(Math.random()<chance) triggerCrash("normal");
    scheduleCrash();
  },delay);
}

function whaleBot(){
  let now=Date.now();
  if(now-lastWhaleCrashTime>WHALE_COOLDOWN && Math.random()<0.2 && !crashActive){
    lastWhaleCrashTime=now;
    triggerCrash("whale");
    return;
  }
}

function updateUI(){
  let net=cash;
  let container=document.getElementById("coins");
  container.innerHTML="";

  coins.forEach((c,i)=>{
    net+= (c.holdings+c.staked)*c.price;

    container.innerHTML+=`
    <div class="coin">
      <h3>${c.name}</h3>
      <p>Price: $${c.price.toFixed(2)}</p>
      <p>Liquid: ${c.holdings.toFixed(2)}</p>
      <p>Staked: ${c.staked.toFixed(2)}</p>

      <input id="qty-${i}" type="number" placeholder="Coins">
      <button onclick="buy(${i})">Buy</button>
      <button onclick="sell(${i})">Sell</button>
      <button onclick="sellAll(${i})">Sell All</button>
      <button onclick="stake(${i})">Stake</button>
      <button onclick="unstake(${i})">Unstake</button>

      <br><input id="dollar-${i}" type="number" placeholder="$ amount">
      <button onclick="buyDollar(${i})">Buy $</button>
    </div>
    `;
  });

  document.getElementById("cash").innerText=cash.toFixed(2);
  document.getElementById("networth").innerText=net.toFixed(2);
  document.getElementById("tapValue").innerText=tapAmount;
  document.getElementById("upgradeCost").innerText=upgradeCost;

  saveGame();
}

loadGame();
setInterval(updatePrices,1000);
setInterval(whaleBot,20000);
scheduleCrash();
updateUI();

</script>
</body>
</html>
